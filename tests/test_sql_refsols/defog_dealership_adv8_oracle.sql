WITH "_S6" AS (
  SELECT DISTINCT
    COLUMN1 AS MONTH_START
  FROM (VALUES
    (CAST('2025-08-01 00:00:00' AS TIMESTAMP)),
    (CAST('2025-09-01 00:00:00' AS TIMESTAMP)),
    (CAST('2025-10-01 00:00:00' AS TIMESTAMP)),
    (CAST('2025-11-01 00:00:00' AS TIMESTAMP)),
    (CAST('2025-12-01 00:00:00' AS TIMESTAMP)),
    (CAST('2026-01-01 00:00:00' AS TIMESTAMP))) AS MONTHS_RANGE(MONTH_START)
  CROSS JOIN MAIN.SALES SALES
), "_S7" AS (
  SELECT
    COLUMN1 AS MONTH_START,
    COUNT(*) AS N_ROWS,
    SUM(SALES.sale_price) AS SUM_SALE_PRICE
  FROM (VALUES
    (CAST('2025-08-01 00:00:00' AS TIMESTAMP)),
    (CAST('2025-09-01 00:00:00' AS TIMESTAMP)),
    (CAST('2025-10-01 00:00:00' AS TIMESTAMP)),
    (CAST('2025-11-01 00:00:00' AS TIMESTAMP)),
    (CAST('2025-12-01 00:00:00' AS TIMESTAMP)),
    (CAST('2026-01-01 00:00:00' AS TIMESTAMP))) AS MONTHS_RANGE_2(MONTH_START)
  JOIN MAIN.SALES SALES
    ON TO_CHAR(COLUMN1, '%Y-%m') = TO_CHAR(SALES.sale_date, '%Y-%m')
  JOIN MAIN.SALESPERSONS SALESPERSONS
    ON EXTRACT(YEAR FROM CAST(SALESPERSONS.hire_date AS DATE)) <= 2023
    AND EXTRACT(YEAR FROM CAST(SALESPERSONS.hire_date AS DATE)) >= 2022
    AND SALES.salesperson_id = SALESPERSONS."_id"
  GROUP BY
    COLUMN1
)
SELECT
  TO_CHAR("_S6".MONTH_START, '%Y-%m-%d') AS month,
  COALESCE("_S7".N_ROWS, 0) AS PMSPS,
  COALESCE("_S7".SUM_SALE_PRICE, 0) AS PMSR
FROM "_S6" "_S6"
LEFT JOIN "_S7" "_S7"
  ON "_S6".MONTH_START = "_S7".MONTH_START
ORDER BY
  "_S6".MONTH_START NULLS FIRST
