ROOT(columns=[('date_time', date_time), ('txn_within_day', txn_within_day), ('n_buys_within_day', n_buys_within_day), ('pct_apple_txns', pct_apple_txns), ('share_change', share_change), ('rolling_avg_amount', rolling_avg_amount)], orderings=[(date_time):asc_first])
 PROJECT(columns={'date_time': date_time, 'n_buys_within_day': RELCOUNT(args=[KEEP_IF(sbTxType, sbTxType == 'buy':string)], partition=[txn_day], order=[(date_time):asc_last], cumulative=True), 'pct_apple_txns': ROUND(100.0:numeric * RELSUM(args=[ISIN(sbTickerSymbol, ['AAPL', 'AMZN']:array[unknown])], partition=[], order=[(date_time):asc_last], cumulative=True) / RELSIZE(args=[], partition=[], order=[(date_time):asc_last], cumulative=True), 2:numeric), 'rolling_avg_amount': ROUND(RELAVG(args=[amount], partition=[], order=[(date_time):asc_last], cumulative=True), 2:numeric), 'share_change': RELSUM(args=[IFF(sbTxType == 'buy':string, sbTxShares, 0:numeric - sbTxShares)], partition=[], order=[(date_time):asc_last], cumulative=True), 'txn_within_day': RELSIZE(args=[], partition=[txn_day], order=[(date_time):asc_last], cumulative=True)})
  JOIN(condition=t0.sbTxTickerId == t1.sbTickerId, type=INNER, cardinality=SINGULAR_ACCESS, columns={'amount': t0.amount, 'date_time': t0.date_time, 'sbTickerSymbol': t1.sbTickerSymbol, 'sbTxShares': t0.sbTxShares, 'sbTxType': t0.sbTxType, 'txn_day': t0.txn_day})
   PROJECT(columns={'amount': amount, 'date_time': date_time, 'sbTxShares': sbTxShares, 'sbTxTickerId': sbTxTickerId, 'sbTxType': sbTxType, 'txn_day': DATETIME(date_time, 'start of day':string)})
    FILTER(condition=MONTH(sbTxDateTime) == 4:numeric & YEAR(sbTxDateTime) == 2023:numeric & sbTxStatus == 'success':string, columns={'amount': sbTxAmount, 'date_time': sbTxDateTime, 'sbTxShares': sbTxShares, 'sbTxTickerId': sbTxTickerId, 'sbTxType': sbTxType})
     SCAN(table=main.sbTransaction, columns={'sbTxAmount': sbTxAmount, 'sbTxDateTime': sbTxDateTime, 'sbTxShares': sbTxShares, 'sbTxStatus': sbTxStatus, 'sbTxTickerId': sbTxTickerId, 'sbTxType': sbTxType})
   SCAN(table=main.sbTicker, columns={'sbTickerId': sbTickerId, 'sbTickerSymbol': sbTickerSymbol})
