ROOT(columns=[('date_time', date_time), ('txn_within_day', txn_within_day), ('n_buys_within_day', n_buys_within_day), ('pct_apple_txns', pct_apple_txns), ('share_change', share_change), ('rolling_avg_amount', rolling_avg_amount)], orderings=[(date_time):asc_first])
 PROJECT(columns={'date_time': date_time, 'n_buys_within_day': RELCOUNT(args=[KEEP_IF(transaction_type, transaction_type == 'buy':string)], partition=[txn_day], order=[(date_time):asc_last], cumulative=True), 'pct_apple_txns': ROUND(100.0:numeric * RELSUM(args=[ISIN(symbol, ['AAPL', 'AMZN']:array[unknown])], partition=[], order=[(date_time):asc_last], cumulative=True) / RELSIZE(args=[], partition=[], order=[(date_time):asc_last], cumulative=True), 2:numeric), 'rolling_avg_amount': ROUND(RELAVG(args=[amount], partition=[], order=[(date_time):asc_last], cumulative=True), 2:numeric), 'share_change': RELSUM(args=[IFF(transaction_type == 'buy':string, shares, 0:numeric - shares)], partition=[], order=[(date_time):asc_last], cumulative=True), 'txn_within_day': RELSIZE(args=[], partition=[txn_day], order=[(date_time):asc_last], cumulative=True)})
  JOIN(conditions=[t0.ticker_id == t1._id], types=['left'], columns={'amount': t0.amount, 'date_time': t0.date_time, 'shares': t0.shares, 'symbol': t1.symbol, 'transaction_type': t0.transaction_type, 'txn_day': t0.txn_day})
   PROJECT(columns={'amount': amount, 'date_time': date_time, 'shares': shares, 'ticker_id': ticker_id, 'transaction_type': transaction_type, 'txn_day': DATETIME(date_time, 'start of day':string)})
    FILTER(condition=MONTH(date_time) == 4:numeric & YEAR(date_time) == 2023:numeric & status == 'success':string, columns={'amount': amount, 'date_time': date_time, 'shares': shares, 'ticker_id': ticker_id, 'transaction_type': transaction_type})
     SCAN(table=main.sbTransaction, columns={'amount': sbTxAmount, 'date_time': sbTxDateTime, 'shares': sbTxShares, 'status': sbTxStatus, 'ticker_id': sbTxTickerId, 'transaction_type': sbTxType})
   SCAN(table=main.sbTicker, columns={'_id': sbTickerId, 'symbol': sbTickerSymbol})
