WITH _t AS (
  SELECT
    sbtxdatetime AS sbTxDateTime,
    ROW_NUMBER() OVER (ORDER BY CASE WHEN sbtxdatetime IS NULL THEN 1 ELSE 0 END, sbtxdatetime) AS _w,
    ROW_NUMBER() OVER (ORDER BY CASE WHEN sbtxdatetime IS NULL THEN 1 ELSE 0 END DESC, sbtxdatetime DESC) AS _w_2
  FROM main.sbTransaction
  WHERE
    EXTRACT(YEAR FROM CAST(sbtxdatetime AS DATETIME)) = 2023
)
SELECT
  sbTxDateTime AS date_time,
  DATE_ADD(
    CAST(DATE_SUB(
      CAST(sbTxDateTime AS DATETIME),
      INTERVAL (
        (
          DAYOFWEEK(CAST(sbTxDateTime AS DATETIME)) + 5
        ) % 7
      ) DAY
    ) AS DATE),
    INTERVAL '-8' WEEK
  ) AS s00,
  FALSE AS s01,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) IN (1, 2, 3) AS s02,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) IN (4, 5, 6) AS s03,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) IN (7, 8, 9) AS s04,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) IN (10, 11, 12) AS s05,
  FALSE AS s06,
  FALSE AS s07,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) < 4 AS s08,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) < 7 AS s09,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) < 10 AS s10,
  TRUE AS s11,
  FALSE AS s12,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) <= 3 AS s13,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) <= 6 AS s14,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) <= 9 AS s15,
  TRUE AS s16,
  TRUE AS s17,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) > 3 AS s18,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) > 6 AS s19,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) > 9 AS s20,
  FALSE AS s21,
  TRUE AS s22,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) >= 4 AS s23,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) >= 7 AS s24,
  EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) >= 10 AS s25,
  FALSE AS s26,
  TRUE AS s27,
  NOT EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) IN (1, 2, 3) AS s28,
  NOT EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) IN (4, 5, 6) AS s29,
  NOT EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) IN (7, 8, 9) AS s30,
  NOT EXTRACT(MONTH FROM CAST(sbTxDateTime AS DATETIME)) IN (10, 11, 12) AS s31,
  TRUE AS s32,
  2024 AS s33,
  3 AS s34,
  8 AS s35,
  13 AS s36,
  12 AS s37,
  45 AS s38,
  59 AS s39,
  2020 AS s40,
  1 AS s41,
  1 AS s42,
  31 AS s43,
  0 AS s44,
  0 AS s45,
  0 AS s46,
  2023 AS s47,
  3 AS s48,
  7 AS s49,
  4 AS s50,
  6 AS s51,
  55 AS s52,
  0 AS s53,
  1999 AS s54,
  4 AS s55,
  12 AS s56,
  31 AS s57,
  23 AS s58,
  59 AS s59,
  58 AS s60,
  FALSE AS s61,
  FALSE AS s62,
  FALSE AS s63,
  TRUE AS s64,
  TRUE AS s65,
  TRUE AS s66,
  FALSE AS s67,
  FALSE AS s68,
  FALSE AS s69,
  TRUE AS s70,
  TRUE AS s71,
  TRUE AS s72,
  FALSE AS s73,
  FALSE AS s74,
  TRUE AS s75,
  TRUE AS s76,
  FALSE AS s77,
  TRUE AS s78,
  FALSE AS s79,
  TRUE AS s80,
  TRUE AS s81,
  FALSE AS s82,
  TRUE AS s83,
  FALSE AS s84
FROM _t
WHERE
  _w = 1 OR _w_2 = 1
